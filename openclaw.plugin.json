{
  "id": "ansible",
  "name": "Ansible",
  "description": "Distributed coordination layer - one agent, multiple bodies",
  "version": "0.1.0",
  "configSchema": {
    "type": "object",
    "properties": {
      "tier": {
        "type": "string",
        "enum": ["backbone", "edge"],
        "description": "Node tier: backbone (always-on VPS) or edge (intermittent client)"
      },
      "nodeIdOverride": {
        "type": "string",
        "description": "Override the node id for addressing within the mesh (useful in Docker where tailscale isn't available inside the container)",
        "examples": ["vps-jane", "jane-vps"]
      },
      "listenPort": {
        "type": "number",
        "default": 1234,
        "description": "WebSocket port for backbone nodes to listen on"
      },
      "listenHost": {
        "type": "string",
        "description": "Host/IP for backbone WebSocket bind; defaults to detected Tailscale IP or 127.0.0.1"
      },
      "backbonePeers": {
        "type": "array",
        "items": { "type": "string" },
        "description": "WebSocket URLs of backbone peers to connect to",
        "examples": ["ws://vps-jane.tail:1234", "ws://100.64.212.8:1234"]
      },
      "capabilities": {
        "type": "array",
        "items": { "type": "string" },
        "default": [],
        "description": "Capabilities this node provides: always-on, local-files, gpu"
      },
      "injectContext": {
        "type": "boolean",
        "default": true,
        "description": "Inject shared ansible context into agent prompts"
      },
      "injectContextAgents": {
        "type": "array",
        "items": { "type": "string" },
        "description": "Optional allowlist of agent IDs that receive ansible context injection"
      },
      "dispatchIncoming": {
        "type": "boolean",
        "default": true,
        "description": "Auto-dispatch inbound ansible messages into agent turns"
      },
      "lockSweep": {
        "type": "object",
        "description": "Per-gateway stale session lock sweeper",
        "properties": {
          "enabled": { "type": "boolean", "default": true, "description": "Enable lock sweeping (default true)" },
          "everySeconds": { "type": "number", "default": 60, "description": "Sweep interval seconds (default 60)", "minimum": 30 },
          "staleSeconds": { "type": "number", "default": 300, "description": "Remove stale lock files older than this many seconds (default 300)", "minimum": 30 }
        }
      },
      "slaSweep": {
        "type": "object",
        "description": "Coordinator-only SLA sweep and escalation engine",
        "properties": {
          "enabled": { "type": "boolean", "default": true, "description": "Enable coordinator SLA sweeps" },
          "everySeconds": { "type": "number", "default": 300, "description": "Sweep cadence in seconds (default 300)", "minimum": 30 },
          "recordOnly": { "type": "boolean", "default": true, "description": "Record escalations without sending messages" },
          "maxMessagesPerSweep": { "type": "number", "default": 3, "description": "Max escalation messages per sweep run", "minimum": 0 },
          "fyiAgents": {
            "type": "array",
            "items": { "type": "string" },
            "default": ["architect"],
            "description": "Fallback FYI agents when requester/claimer targets are unavailable"
          }
        }
      },
      "authGate": {
        "type": "object",
        "description": "Optional pre-Yjs websocket admission gate (invite token for unknown nodes)",
        "properties": {
          "enabled": { "type": "boolean", "default": false, "description": "Enable websocket admission checks" },
          "nodeIdParam": { "type": "string", "default": "nodeId", "description": "Query parameter name for node id" },
          "inviteParam": { "type": "string", "default": "invite", "description": "Query parameter name for invite token" },
          "ticketParam": { "type": "string", "default": "ticket", "description": "Query parameter name for websocket ticket" },
          "requireTicketForUnknown": { "type": "boolean", "default": false, "description": "Require ticket for unknown nodes (disable direct invite query admission)" },
          "authPort": { "type": "number", "description": "HTTP auth exchange port (defaults to listenPort + 1)" },
          "exchangePath": { "type": "string", "default": "/ansible/auth/exchange", "description": "HTTP auth exchange endpoint path" },
          "ticketTtlSeconds": { "type": "number", "default": 60, "description": "Default websocket ticket TTL issued by exchange endpoint" },
          "requireNodeProof": { "type": "boolean", "default": false, "description": "Require client key proof at auth exchange" },
          "rateLimitMax": { "type": "number", "default": 30, "description": "Auth exchange max requests per window (fixed-window)" },
          "rateLimitWindowSeconds": { "type": "number", "default": 60, "description": "Auth exchange fixed-window seconds" }
        }
      }
    },
    "required": ["tier"]
  },
  "uiHints": {
    "tier": {
      "label": "Node Tier",
      "help": "Backbone nodes are always-on servers that form the sync mesh. Edge nodes connect as clients."
    },
    "nodeIdOverride": {
      "label": "Node ID Override",
      "help": "Use a stable name for the node id (recommended in Docker).",
      "advanced": true
    },
    "listenPort": {
      "label": "Listen Port",
      "help": "Port for the WebSocket server (backbone only)",
      "advanced": true
    },
    "listenHost": {
      "label": "Listen Host",
      "help": "Bind host/IP for backbone WebSocket listener (advanced)",
      "advanced": true
    },
    "backbonePeers": {
      "label": "Backbone Peers",
      "help": "WebSocket URLs of backbone nodes to sync with"
    },
    "capabilities": {
      "label": "Capabilities",
      "help": "What this node can do: always-on, local-files, gpu"
    },
    "injectContext": {
      "label": "Inject Context",
      "help": "Include ansible shared context in prompts before agent start",
      "advanced": true
    },
    "injectContextAgents": {
      "label": "Inject Context Agents",
      "help": "Restrict ansible context injection to specific agent IDs",
      "advanced": true
    },
    "dispatchIncoming": {
      "label": "Dispatch Incoming",
      "help": "Auto-route inbound ansible messages into agent turns",
      "advanced": true
    },
    "lockSweep": {
      "label": "Lock Sweep",
      "help": "Automatically clears stale session lock files that can block agent turns (recommended).",
      "advanced": true
    },
    "slaSweep": {
      "label": "SLA Sweep",
      "help": "Coordinator-only task SLA sweep and escalation notifications.",
      "advanced": true
    },
    "authGate": {
      "label": "Auth Gate",
      "help": "Optional websocket admission gate for unknown nodes (invite token at handshake).",
      "advanced": true
    }
  }
}
